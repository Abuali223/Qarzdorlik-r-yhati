<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Qarzdorlik va To‘lovlar</title>
  <style>
    :root{
      --bg:#0e1116; --panel:#151a22; --muted:#8a94a6; --text:#e6eefc;
      --accent:#4f8cff; --accent-2:#22c55e; --warn:#ef4444;
      --border:#232936; --chip:#1d2430; --focus:0 0 0 3px rgba(79,140,255,.35);
      --radius:12px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);
         font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
    .container{max-width:1200px;margin:24px auto;padding:0 16px}
    header{display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:16px}
    .brand{font-weight:700}
    .toolbar{margin-left:auto;display:flex;gap:8px;flex-wrap:wrap}
    button{border:1px solid var(--border);background:var(--chip);color:var(--text);
           padding:8px 14px;border-radius:10px;cursor:pointer;transition:.2s}
    button:hover{filter:brightness(1.08)}
    .btn-green{background:#0f2316;color:#c8f7d1}
    .btn-blue{background:#112033;color:#cde4ff}
    .btn-red{background:#2a1010;color:#ffd0d0}
    .stats{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:12px 0 20px}
    .stat{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:14px 16px}
    .stat h3{margin:0 0 6px;font-size:12px;color:var(--muted)}
    .stat .num{font-size:22px;font-weight:700}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid var(--border)}
    th{color:var(--muted);background:rgba(255,255,255,.02)}
    .row-actions{display:flex;gap:6px;flex-wrap:wrap}
    dialog{border:1px solid var(--border);border-radius:14px;background:var(--panel);color:var(--text);padding:0;max-width:500px;width:calc(100% - 24px)}
    dialog::backdrop{background:rgba(0,0,0,.55)}
    .modal-head{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700}
    .modal-body{padding:16px;display:grid;gap:12px}
    .modal-foot{padding:12px 16px;border-top:1px solid var(--border);display:flex;gap:8px;justify-content:flex-end}
    .field{display:flex;align-items:center;border:1px solid var(--border);background:var(--chip);padding:8px 10px;border-radius:10px;width:100%}
    .field input{background:transparent;border:0;outline:0;color:var(--text);width:100%}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">Qarzdorlik va To‘lovlar</div>
      <div class="toolbar">
        <button id="btnAdd" class="btn-green">+ Mijoz qo‘shish</button>
      </div>
    </header>

    <section class="stats">
      <div class="stat"><h3>Jami qarz</h3><div class="num" id="statQarz">0</div></div>
      <div class="stat"><h3>Qaytgan</h3><div class="num" id="statTolov">0</div></div>
      <div class="stat"><h3>Qoldiq</h3><div class="num" id="statQoldiq">0</div></div>
    </section>

    <table>
      <thead>
        <tr>
          <th>#</th><th>Ism</th><th>Tovar</th><th>Narx</th><th>Berilgan</th><th>Qoldiq</th><th>Amal</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>

  <!-- Mijoz qo'shish oynasi -->
  <dialog id="dlgAdd">
    <div class="modal-head">Mijoz ma’lumoti</div>
    <form method="dialog" id="formAdd">
      <div class="modal-body">
        <label class="field"><input id="name" placeholder="Ism" required></label>
        <label class="field"><input id="qty" type="text" placeholder="Tovar soni"></label>
        <label class="field"><input id="price" type="text" placeholder="Tovar narxi"></label>
        <label class="field"><input id="given" type="text" placeholder="Berilgan summa"></label>
      </div>
      <div class="modal-foot">
        <button type="button" onclick="dlgAdd.close()">Bekor</button>
        <button class="btn-green">Saqlash</button>
      </div>
    </form>
  </dialog>

  <!-- Qarz qo'shish oynasi -->
  <dialog id="dlgQarz">
    <div class="modal-head">Qarz qo‘shish</div>
    <form method="dialog" id="formQarz">
      <div class="modal-body">
        <label class="field"><input id="qarzSumma" type="text" placeholder="Qarz summa"></label>
      </div>
      <div class="modal-foot">
        <button type="button" onclick="dlgQarz.close()">Bekor</button>
        <button class="btn-blue">Tasdiqlash</button>
      </div>
    </form>
  </dialog>

  <!-- To'lov kiritish oynasi -->
  <dialog id="dlgTolov">
    <div class="modal-head">To‘lov kiritish</div>
    <form method="dialog" id="formTolov">
      <div class="modal-body">
        <label class="field"><input id="tolovSumma" type="text" placeholder="To‘lov summa"></label>
      </div>
      <div class="modal-foot">
        <button type="button" onclick="dlgTolov.close()">Bekor</button>
        <button class="btn-green">Tasdiqlash</button>
      </div>
    </form>
  </dialog>

<script>
let data = [];
let currentIndex = null;
const tbody = document.getElementById('tbody');
const fmt = n => (Number(n)||0).toLocaleString('uz-UZ');

function fmtInput(e){
  let val = e.target.value.replace(/\s/g,'').replace(/,/g,'');
  if(isNaN(val) || val === ''){ e.target.dataset.raw=''; e.target.value=''; return; }
  e.target.dataset.raw = val;
  e.target.value = fmt(val);
}
function getVal(id){
  const el = document.getElementById(id);
  return Number(el.dataset.raw || el.value.replace(/\s/g,'').replace(/,/g,'') || 0);
}

function refresh(){
  tbody.innerHTML='';
  let jamiQarz=0, jamiTolov=0, jamiQoldiq=0;
  data.forEach((c,i)=>{
    const asosiy = c.qty*c.price;
    const qoldiq = asosiy - c.given;
    jamiQarz += asosiy;
    jamiTolov += c.given;
    jamiQoldiq += qoldiq;
    tbody.innerHTML += `
      <tr>
        <td>${i+1}</td>
        <td>${c.name}</td>
        <td>${fmt(c.qty)}</td>
        <td>${fmt(c.price)}</td>
        <td>${fmt(c.given)}</td>
        <td>${fmt(qoldiq)}</td>
        <td class="row-actions">
          <button class="btn-blue" onclick="openQarz(${i})">Qarz</button>
          <button class="btn-green" onclick="openTolov(${i})">To‘lov</button>
          <button class="btn-red" onclick="del(${i})">O‘chirish</button>
        </td>
      </tr>`;
  });
  document.getElementById('statQarz').textContent = fmt(jamiQarz);
  document.getElementById('statTolov').textContent = fmt(jamiTolov);
  document.getElementById('statQoldiq').textContent = fmt(jamiQoldiq);
}
function del(i){
  data.splice(i,1);
  refresh();
}

document.getElementById('btnAdd').onclick = ()=>{
  document.getElementById('formAdd').reset();
  ['qty','price','given'].forEach(id=>{
    const el=document.getElementById(id);
    el.dataset.raw=''; el.value='';
  });
  dlgAdd.showModal();
};

document.getElementById('formAdd').onsubmit = ()=>{
  data.push({
    name: document.getElementById('name').value.trim(),
    qty: getVal('qty'),
    price: getVal('price'),
    given: getVal('given')
  });
  refresh();
};

function openQarz(i){
  currentIndex = i;
  document.getElementById('qarzSumma').value='';
  document.getElementById('qarzSumma').dataset.raw='';
  dlgQarz.showModal();
}
document.getElementById('formQarz').onsubmit = ()=>{
  const summa = getVal('qarzSumma');
  data[currentIndex].qty += summa / data[currentIndex].price;
  refresh();
};

function openTolov(i){
  currentIndex = i;
  document.getElementById('tolovSumma').value='';
  document.getElementById('tolovSumma').dataset.raw='';
  dlgTolov.showModal();
}
document.getElementById('formTolov').onsubmit = ()=>{
  const summa = getVal('tolovSumma');
  data[currentIndex].given += summa;
  refresh();
};

['qty','price','given','qarzSumma','tolovSumma'].forEach(id=>{
  document.getElementById(id).addEventListener('input', fmtInput);
});
</script>
</body>
</html>